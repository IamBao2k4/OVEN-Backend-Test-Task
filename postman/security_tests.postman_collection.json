{
  "info": {
    "name": "OVEN Backend - Security Tests",
    "description": "Test collection for authentication and authorization security",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "12347"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000/api/v1",
      "type": "string"
    },
    {
      "key": "validAccessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "validRefreshToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "testUsername",
      "value": "securitytestuser",
      "type": "string"
    },
    {
      "key": "testPassword",
      "value": "Test@123456",
      "type": "string"
    },
    {
      "key": "expiredToken",
      "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyLCJleHAiOjE1MTYyMzkwMjJ9.4Adcj0vVl7hDY8K5GKQP-Z5wTQNfWDqFqJKy3K9M8sI",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "0. Setup (Run First)",
      "item": [
        {
          "name": "Register Test User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201 or 409 (already exists)\", function () {",
                  "    pm.expect([201, 409, 400]).to.include(pm.response.code);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    console.log('✓ Test user registered successfully');",
                  "} else if (pm.response.code === 409 || pm.response.code === 400) {",
                  "    console.log('✓ Test user already exists, proceeding to login');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{testUsername}}\",\n  \"password\": \"{{testPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            },
            "description": "Register a test user for security tests (can skip if already exists)"
          },
          "response": []
        },
        {
          "name": "Login Test User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Tokens received\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('accessToken');",
                  "    pm.expect(jsonData.data).to.have.property('refreshToken');",
                  "    ",
                  "    // Save tokens for later tests",
                  "    pm.collectionVariables.set('validAccessToken', jsonData.data.accessToken);",
                  "    pm.collectionVariables.set('validRefreshToken', jsonData.data.refreshToken);",
                  "    ",
                  "    console.log('✓ Access token saved:', jsonData.data.accessToken.substring(0, 20) + '...');",
                  "    console.log('✓ Refresh token saved:', jsonData.data.refreshToken.substring(0, 20) + '...');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"{{testUsername}}\",\n  \"password\": \"{{testPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login to get valid access and refresh tokens for testing"
          },
          "response": []
        }
      ],
      "description": "⚠️ RUN THIS FOLDER FIRST to setup test user and get valid tokens"
    },
    {
      "name": "Authorization Tests",
      "item": [
        {
          "name": "Webhooks - No Authorization Header",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403\", function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test(\"Response has error message\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('message');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/webhooks",
              "host": ["{{baseUrl}}"],
              "path": ["webhooks"]
            },
            "description": "Test accessing webhooks without Authorization header"
          },
          "response": []
        },
        {
          "name": "Webhooks - Malformed Authorization Header",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403\", function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "InvalidFormat token123"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/webhooks",
              "host": ["{{baseUrl}}"],
              "path": ["webhooks"]
            },
            "description": "Test with malformed Authorization header (not 'Bearer')"
          },
          "response": []
        },
        {
          "name": "Webhooks - Bearer Without Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403\", function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer "
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/webhooks",
              "host": ["{{baseUrl}}"],
              "path": ["webhooks"]
            },
            "description": "Test with 'Bearer' but no token"
          },
          "response": []
        },
        {
          "name": "Webhooks - Invalid Token Format",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403\", function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer not-a-valid-jwt-token"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/webhooks",
              "host": ["{{baseUrl}}"],
              "path": ["webhooks"]
            },
            "description": "Test with invalid JWT token format"
          },
          "response": []
        },
        {
          "name": "Webhooks - Expired Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403\", function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{expiredToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/webhooks",
              "host": ["{{baseUrl}}"],
              "path": ["webhooks"]
            },
            "description": "Test with expired JWT token"
          },
          "response": []
        },
        {
          "name": "Webhooks - Token with Wrong Signature",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403\", function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxMjMiLCJ1c2VybmFtZSI6InRlc3QifQ.wrong_signature_here"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/webhooks",
              "host": ["{{baseUrl}}"],
              "path": ["webhooks"]
            },
            "description": "Test with JWT token that has wrong signature"
          },
          "response": []
        },
        {
          "name": "Create Webhook - No Auth",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403\", function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"source\": \"test\",\n  \"event\": \"test.event\",\n  \"payload\": {}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/webhooks",
              "host": ["{{baseUrl}}"],
              "path": ["webhooks"]
            },
            "description": "Test creating webhook without authentication"
          },
          "response": []
        },
        {
          "name": "Get Webhook By ID - No Auth",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403\", function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/webhooks/00000000-0000-0000-0000-000000000000",
              "host": ["{{baseUrl}}"],
              "path": ["webhooks", "00000000-0000-0000-0000-000000000000"]
            },
            "description": "Test getting webhook by ID without authentication"
          },
          "response": []
        }
      ],
      "description": "Tests for authentication and authorization security"
    },
    {
      "name": "Token Security Tests",
      "item": [
        {
          "name": "Refresh - Expired Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403\", function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{expiredToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            },
            "description": "Test refresh with expired refresh token"
          },
          "response": []
        },
        {
          "name": "Refresh - Invalid JWT Structure",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403 or 400\", function () {",
                  "    pm.expect([400, 401, 403]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"header.payload\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            },
            "description": "Test refresh with malformed JWT (missing signature)"
          },
          "response": []
        },
        {
          "name": "Refresh - Access Token Instead of Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401 or 403\", function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{validAccessToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            },
            "description": "Test refresh using access token instead of refresh token"
          },
          "response": []
        }
      ],
      "description": "Tests for token security and validation"
    },
    {
      "name": "SQL Injection Tests",
      "item": [
        {
          "name": "Login - SQL Injection in Username",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400 or 401\", function () {",
                  "    pm.expect([400, 401]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test(\"SQL injection is prevented\", function () {",
                  "    pm.expect(pm.response.code).to.not.equal(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin' OR '1'='1\",\n  \"password\": \"password\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Test SQL injection in username field"
          },
          "response": []
        },
        {
          "name": "Register - SQL Injection in Username",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400 or 201\", function () {",
                  "    pm.expect([400, 201]).to.include(pm.response.code);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"test'; DROP TABLE users; --\",\n  \"password\": \"Test@123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            },
            "description": "Test SQL injection attempt in registration"
          },
          "response": []
        }
      ],
      "description": "Tests for SQL injection vulnerability prevention"
    },
    {
      "name": "XSS Prevention Tests",
      "item": [
        {
          "name": "Register - XSS in Username",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201 or 400\", function () {",
                  "    pm.expect([201, 400]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test(\"Response does not execute script\", function () {",
                  "    var responseText = pm.response.text();",
                  "    pm.expect(responseText).to.not.include('<script>');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"<script>alert('XSS')</script>\",\n  \"password\": \"Test@123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            },
            "description": "Test XSS prevention in username field"
          },
          "response": []
        },
        {
          "name": "Webhook - XSS in Source",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201 or 400\", function () {",
                  "    pm.expect([201, 400]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test(\"Response is properly escaped\", function () {",
                  "    var responseText = pm.response.text();",
                  "    pm.expect(responseText).to.not.include('<script>');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{validAccessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"source\": \"<img src=x onerror=alert('XSS')>\",\n  \"event\": \"test.event\",\n  \"payload\": {}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/webhooks",
              "host": ["{{baseUrl}}"],
              "path": ["webhooks"]
            },
            "description": "Test XSS prevention in webhook source field"
          },
          "response": []
        }
      ],
      "description": "Tests for XSS (Cross-Site Scripting) prevention"
    }
  ]
}
